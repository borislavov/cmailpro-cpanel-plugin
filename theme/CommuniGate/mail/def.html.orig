<cpanel setvar="headerimg=../images/mailmenu.gif">
<cpanel setvar="dprefix=../">
<cpanel Branding="include(stdheader.html)">
<style type="text/css">
<?cp Branding::spritelist(.spriteicon_img_mini {float:left;margin-right:5px;background: url\{leftparenthesis}"%"\{rightparenthesis};} %,@spriteurl,images::#icon-${img}_mini {background-position\{colon}0 -${cssposition}px;width\{colon}${width}px;height\{colon}${height}px; }:) imgtype=icon,subtype=img,method=scale_60percent,format=png,img=defaultemailacct ?>
</style>
<div class="body-content">

<cpanel include="managelist.html">

<div class="h1Title"><div class="spriteicon_img_mini" id="icon-defaultemailacct_mini"></div><cpanel langprint="EMSetDefaultAddr"></div>
<p class="description"><cpanel langprint="EMDefaultDesc"></p>
<br />
<h2><cpanel langprint="EADefaultmaint"></h2>

<form method="post" name="fwdf" id="fwdf" action="dosetdef.html" onsubmit="return do_validate(this.id);">
<div class="highlight">
	<h2><cpanel langprint="EADefaultsendall"></h2>

	<select id="defsel" name="domain" onchange="loaddest();">
	<cpanel Email="printdomainoptions()">
	</select>

<script type="text/javascript">
//<![CDATA[
var input_modded = 0;
function defcallback(result) {
    var defaddy = result[0]['defaultaddress'] || '<cpanel langprint="NTNotFound">';
    defaddy = defaddy.replace(/^\"/,'').replace(/\"$/,'');
    document.getElementById('currentdest').innerHTML=defaddy;
    var inputEl = document.getElementById('fwdemail');
    if (!input_modded && inputEl) {
        var fwd_radio = document.fwdf.fwdopt;
        var emailtest=/^.+@.+\./;
        var localtest=/^\s*\w+\s*$/;

        var failtest = /^\s*:fail:/;
        var discardtest = /^\s*:blackhole:/;
        var system_user_test = /^<cpanel print="$user">$/;
        var pipetest = /\|/;
        var advEl = document.getElementById('advance');
        var userval = document.getElementById("user").value;
        
		if (system_user_test.test(defaddy)) {
            selectRadioByValue(fwd_radio,'system');
			CPANEL.animate.slide_down(advEl);
        }
		else if (emailtest.test(defaddy) || localtest.test(defaddy) || defaddy == userval) {
            selectRadioByValue(fwd_radio,'fwd');
            inputEl.value=defaddy;
            if (advEl) { advEl.style.display='none'; }
        }
		else if (failtest.test(defaddy)) {
            selectRadioByValue(fwd_radio,'fail');
            var failEl = document.getElementById('fail_input');        
            if (failEl) { failEl.value = defaddy.replace(/\s*:fail:\s*/,''); }
            if (advEl) { advEl.style.display='none'; }
        }
		else if (discardtest.test(defaddy)) {
            selectRadioByValue(fwd_radio,'blackhole');
			CPANEL.animate.slide_down(advEl);
        }
		else if (pipetest.test(defaddy)) {
            selectRadioByValue(fwd_radio,'pipe');
            var pipeEl = document.getElementById('pipefwd');
            if (pipeEl) { pipeEl.value = defaddy.replace(/\s*\|\s*/,'').replace('<cpanel print="$homedir">','').replace(/^\//,''); }
			CPANEL.animate.slide_down(advEl);
        }
    }
}
function selectRadioByValue(El,Tvalue) {
    for(var i=0;i<El.length;i++) {
        if (El[i].value == Tvalue) {
            El[i].checked=true;
            break;
        }
    }
}
function loaddest() {
    input_modded = 0;
    document.getElementById('showdest').style.display='';
    var defsel = document.getElementById('defsel');
    var domain = defsel.options[defsel.selectedIndex].value;
    document.getElementById('currentdest').innerHTML='<cpanel langprint="updatingg">....';
    cpanel_jsonapi2(defcallback,'Email','listdefaultaddresses','domain',domain);
}
YAHOO.util.Event.onDOMReady(loaddest);
//]]>
</script>
	<span id="showdest" style="display:none;">
		<b><cpanel langprint="contact_index_current"></b>: <span id="currentdest"></span>
	</span>
	<cpanel include="definclude.html">
</div>
</form>

</div>
<cpanel Branding="include(stdfooter.html)">

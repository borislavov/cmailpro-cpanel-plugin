var VALID=[];var CHANGE_VALID=[];var OPEN_MODULE=null;var MXRECORDS_TABLE_UPDATING=0;var ANIMATING=false;var toggle_module=function(b){if(ANIMATING==false){ANIMATING=true;if(OPEN_MODULE==b){before_hide_module(b);CPANEL.animate.slide_up(OPEN_MODULE,function(){after_hide_module(b);ANIMATING=false;OPEN_MODULE=null})}else{if(YAHOO.util.Dom.getStyle(OPEN_MODULE,"display")=="block"){var a=OPEN_MODULE;before_hide_module(a);CPANEL.animate.slide_up(OPEN_MODULE,function(){after_hide_module(a)})}before_show_module(b);CPANEL.animate.slide_down(b,function(){after_show_module(b);ANIMATING=false;OPEN_MODULE=b})}}};var before_hide_module=function(d){var b=d.split("_");var c=b[0];d=b[1];if(c=="edit"){for(var a in CHANGE_VALID){if(!CHANGE_VALID.hasOwnProperty(a)){continue}CHANGE_VALID[a].clear_messages()}}};var after_hide_module=function(c){var a=c.split("_");var b=a[0];c=a[1];if(b=="edit"){YAHOO.util.Event.purgeElement("priority_"+c);YAHOO.util.Event.purgeElement("destination_"+c);YAHOO.util.Event.purgeElement("confirm_edit_"+c);YAHOO.util.Dom.setStyle("edit_input_"+c,"display","block");YAHOO.util.Dom.get("edit_status_"+c).innerHTML=""}if(b=="delete"){YAHOO.util.Dom.setStyle("delete_input_"+c,"display","block");YAHOO.util.Dom.get("delete_status_"+c).innerHTML=""}};var before_show_module=function(a){};var after_show_module=function(c){var a=c.split("_");var b=a[0];c=a[1];if(b=="edit"){CHANGE_VALID.priority=new CPANEL.validate.validator(LANG.MX_priority);CHANGE_VALID.priority.add("priority_"+c,"positive_integer",LANG.MX_priority_positive_integer);CHANGE_VALID.priority.attach();CHANGE_VALID.destination=new CPANEL.validate.validator(LANG.MX_destination);CHANGE_VALID.destination.add("destination_"+c,"fqdn",LANG.MX_destination_fqdn);CHANGE_VALID.destination.attach();CHANGE_VALID.content_changed=new CPANEL.validate.validator(LANG.content_changed);CHANGE_VALID.content_changed.add("old_destination_"+c,function(){return content_changed(c)},LANG.must_change_before_edit);CHANGE_VALID.content_changed.attach();CPANEL.validate.attach_to_form("confirm_edit_"+c,CHANGE_VALID,function(){edit_mx_record(c)});CPANEL.util.catch_enter(["priority_"+c,"destination_"+c],"confirm_edit_"+c)}};var add_mx_record=function(){var a=YAHOO.util.Dom.get("destination").value;var b=YAHOO.util.Dom.get("priority").value;var d={cpanel_jsonapi_version:2,cpanel_jsonapi_module:"Email",cpanel_jsonapi_func:"addmx",domain:YAHOO.util.Dom.get("domain").value,exchanger:a,preference:b};var c={success:function(h){var f;try{f=YAHOO.lang.JSON.parse(h.responseText)}catch(g){CPANEL.widgets.status_bar("add_new_record_status_bar","error",CPANEL.lang.json_error,CPANEL.lang.json_parse_failed);reset_add_mx_record();update_mx_records_table();return}if(f.cpanelresult.error){CPANEL.widgets.status_bar("add_new_record_status_bar","error",CPANEL.lang.Error,f.cpanelresult.error);reset_add_mx_record();update_mx_records_table()}else{if(f.cpanelresult.data[0].status==1){if(f.cpanelresult.data[0].checkmx.warnings&&f.cpanelresult.data[0].checkmx.warnings.length){var i=build_warnings_html(f.cpanelresult.data[0].checkmx.warnings);CPANEL.widgets.status_bar("add_new_record_status_bar","warning",LANG.MX_added_record,b+" &rarr; "+a+"<br />"+i,{noCountdown:true})}else{CPANEL.widgets.status_bar("add_new_record_status_bar","success",LANG.MX_added_record,b+" &rarr; "+a)}reset_add_mx_record();update_mx_state_from_checkmx(f.cpanelresult.data[0].checkmx);update_mxcheck_auto_warnings(f.cpanelresult.data[0].checkmx.warnings);update_mx_records_table()}else{CPANEL.widgets.status_bar("add_new_record_status_bar","error",CPANEL.lang.Error,f.cpanelresult.data[0].statusmsg);reset_add_mx_record();update_mx_records_table()}}},failure:function(e){CPANEL.widgets.status_bar("add_new_record_status_bar","error",CPANEL.lang.ajax_error,CPANEL.lang.ajax_try_again);reset_add_mx_record();update_mx_records_table()}};YAHOO.util.Connect.asyncRequest("GET",CPANEL.urls.json_api(d),c,"");YAHOO.util.Dom.setStyle("submit_mx_record","display","none");YAHOO.util.Dom.get("add_new_record_status").innerHTML=CPANEL.icons.ajax+" "+LANG.MX_adding_record};var content_changed=function(c){var b=YAHOO.util.Dom.get("old_priority_"+c).value+YAHOO.util.Dom.get("old_destination_"+c).value;var a=YAHOO.util.Dom.get("priority_"+c).value+YAHOO.util.Dom.get("destination_"+c).value;return(b!=a)};var reset_add_mx_record=function(){YAHOO.util.Dom.setStyle("submit_mx_record","display","block");YAHOO.util.Dom.get("add_new_record_status").innerHTML="";YAHOO.util.Dom.get("priority").value="0";YAHOO.util.Dom.get("destination").value="";for(var a in VALID){if(!VALID.hasOwnProperty(a)){continue}VALID[a].clear_messages()}};var build_warnings_html=function(a){var c="<ul>";for(var b=0;b<a.length;b++){c+="<li>"+a[b]+"</li>"}c+="</ul>";return c};var update_mxcheck_auto_warnings=function(a){};var delete_mx_record=function(e,b,a){var b=document.getElementById("priority_"+e).value;var a=document.getElementById("destination_"+e).value;var d={cpanel_jsonapi_version:2,cpanel_jsonapi_module:"Email",cpanel_jsonapi_func:"delmx",domain:YAHOO.util.Dom.get("domain").value,exchange:a,preference:b};var c={success:function(h){try{var f=YAHOO.lang.JSON.parse(h.responseText);if(f.cpanelresult.error){toggle_module("delete_"+e);CPANEL.widgets.status_bar("status_bar_"+e,"error",CPANEL.lang.Error,f.cpanelresult.error)}else{if(f.cpanelresult.data[0].status==1){CPANEL.animate.fade_out("info_row_"+e,function(){var j=true;var l=YAHOO.util.Dom.getElementsByClassName("dt_info_row","tr","mx_records_table");for(var k=0;k<l.length;k++){if(YAHOO.util.Dom.getStyle(l[k],"display")!="none"){j=false}}if(j){update_mx_records_table()}update_mxcheck_auto_warnings(f.cpanelresult.data[0].checkmx.warnings)});CPANEL.animate.fade_out("module_row_"+e);update_mx_state_from_checkmx(f.cpanelresult.data[0].checkmx)}else{toggle_module("delete_"+e);CPANEL.widgets.status_bar("status_bar_"+e,"error",CPANEL.lang.Error,f.cpanelresult.data[0].statusmsg)}}}catch(g){toggle_module("delete_"+e);CPANEL.widgets.status_bar("status_bar_"+e,"error",CPANEL.lang.json_error,CPANEL.lang.json_parse_failed)}},failure:function(f){toggle_module("delete_"+e);CPANEL.widgets.status_bar("status_bar_"+e,"error",CPANEL.lang.ajax_error,CPANEL.lang.ajax_try_again)}};YAHOO.util.Connect.asyncRequest("GET",CPANEL.urls.json_api(d),c,"");YAHOO.util.Dom.setStyle("delete_input_"+e,"display","none");YAHOO.util.Dom.get("delete_status_"+e).innerHTML=CPANEL.icons.ajax+" "+LANG.MX_deleting_record};var update_mx_state_from_checkmx=function(a){YAHOO.util.Dom.get("mxcheck_state").value=a.mxcheck;YAHOO.util.Dom.get("detected_state").value=a.detected;YAHOO.util.Dom.get("mxcheck_status").innerHTML="";update_mxcheck_state_ui()};var edit_mx_record=function(e){var a=YAHOO.util.Dom.get("priority_"+e).value;var b=YAHOO.util.Dom.get("destination_"+e).value;var d={cpanel_jsonapi_version:2,cpanel_jsonapi_module:"Email",cpanel_jsonapi_func:"changemx",domain:YAHOO.util.Dom.get("domain").value,exchanger:b,preference:a,oldexchanger:YAHOO.util.Dom.get("old_destination_"+e).value,oldpreference:YAHOO.util.Dom.get("old_priority_"+e).value};var c={success:function(h){try{var f=YAHOO.lang.JSON.parse(h.responseText);if(f.cpanelresult.error){toggle_module("edit_"+e);CPANEL.widgets.status_bar("status_bar_"+e,"error",CPANEL.lang.Error,f.cpanelresult.error)}else{if(f.cpanelresult.data[0].status==1){YAHOO.util.Dom.get("old_priority_"+e).value=a;YAHOO.util.Dom.get("old_destination_"+e).value=b;YAHOO.util.Dom.get("display_priority_"+e).innerHTML=a;YAHOO.util.Dom.get("display_destination_"+e).innerHTML=b;toggle_module("edit_"+e);if(f.cpanelresult.data[0].checkmx.warnings&&f.cpanelresult.data[0].checkmx.warnings.length){var i=build_warnings_html(f.cpanelresult.data[0].checkmx.warnings);CPANEL.widgets.status_bar("status_bar_"+e,"warning",LANG.MX_changed_record,i,{noCountdown:true})}else{CPANEL.widgets.status_bar("status_bar_"+e,"success",LANG.MX_changed_record)}update_mx_state_from_checkmx(f.cpanelresult.data[0].checkmx);update_mxcheck_auto_warnings(f.cpanelresult.data[0].checkmx.warnings)}else{toggle_module("edit_"+e);CPANEL.widgets.status_bar("status_bar_"+e,"error",CPANEL.lang.Error,f.cpanelresult.data[0].statusmg)}}}catch(g){toggle_module("edit_"+e);CPANEL.widgets.status_bar("status_bar_"+e,"error",CPANEL.lang.json_error,CPANEL.lang.json_parse_failed)}},failure:function(f){toggle_module("edit_"+e);CPANEL.widgets.status_bar("status_bar_"+e,"error",CPANEL.lang.ajax_error,CPANEL.lang.ajax_try_again)}};YAHOO.util.Connect.asyncRequest("GET",CPANEL.urls.json_api(d),c,"");YAHOO.util.Dom.setStyle("edit_input_"+e,"display","none");YAHOO.util.Dom.get("edit_status_"+e).innerHTML=CPANEL.icons.ajax+" "+LANG.MX_editing_record};var check_default_A_record=function(b){if(b.search('<td id="display_destination_1">A Record</td>')!=-1&&b.search('<tr id="info_row_2"')==-1){b=b.replace(/\n/g,"");var a='<td colspan="3">'+LANG.MX_no_records_set+"</td></tr>";var c=new RegExp(/<td id="display_priority_1">.*?<\/tr>/i);b=b.replace(c,a)}return b};var update_mx_records_table=function(){if(MXRECORDS_TABLE_UPDATING){return}MXRECORDS_TABLE_UPDATING=1;var d={success:function(f){MXRECORDS_TABLE_UPDATING=0;var e=check_default_A_record(f.responseText);YAHOO.util.Dom.get("mx_entries").innerHTML=e;YAHOO.util.Dom.get("mxcheck_status").innerHTML="";update_mxcheck_state_ui()},failure:function(e){MXRECORDS_TABLE_UPDATING=0;YAHOO.util.Dom.get("mx_entries").innerHTML='<div style="padding: 20px">'+CPANEL.icons.error+" "+CPANEL.lang.ajax_error+": "+CPANEL.lang.ajax_try_again+"</div>"}};var c=YAHOO.util.Dom.get("domain").value;YAHOO.util.Connect.asyncRequest("GET","mx_records.html?domain="+c+"&cache_fix="+new Date().getTime(),d,"");var b=YAHOO.util.Region.getRegion(YAHOO.util.Dom.get("mx_entries"));var a=parseInt(b.height)-20;YAHOO.util.Dom.get("mx_entries").innerHTML='<div style="height: '+b.height+'px; padding: 20px 0px 0px 20px">'+CPANEL.icons.ajax+" "+CPANEL.lang.ajax_loading+"</div>";YAHOO.util.Dom.get("change_mxcheck_button").disabled=true;YAHOO.util.Dom.get("mxcheck_status").innerHTML=CPANEL.lang.ajax_loading;deselect_mxcheck_ui()};var change_mxcheck=function(c){var a=YAHOO.util.Dom.get("mxcheck_state");var b=CPANEL.util.get_radio_value("mxcheck","mxcheck_options_div");if(a.value==b){return true}var e={cpanel_jsonapi_version:2,cpanel_jsonapi_module:"Email",cpanel_jsonapi_func:"setmxcheck",domain:YAHOO.util.Dom.get("domain").value,mxcheck:b};var d={success:function(h){try{var f=YAHOO.lang.JSON.parse(h.responseText);if(f.cpanelresult.error){YAHOO.util.Dom.get("mxcheck_status").innerHTML=CPANEL.icons.error+" "+f.cpanelresult.error}else{if(f.cpanelresult.data[0].status==1){a.value=f.cpanelresult.data[0].mxcheck;YAHOO.util.Dom.get("detected_state").value=f.cpanelresult.data[0].detected;YAHOO.util.Dom.get("mxcheck_status").innerHTML="";update_mxcheck_auto_warnings(f.cpanelresult.data[0].checkmx.warnings)}else{YAHOO.util.Dom.get("mxcheck_status").innerHTML=CPANEL.icons.error+" "+f.cpanelresult.data[0].statusmsg}}}catch(g){YAHOO.util.Dom.get("mxcheck_status").innerHTML=CPANEL.icons.error+" "+CPANEL.lang.json_parse_failed}update_mxcheck_state_ui()},failure:function(f){YAHOO.util.Dom.get("mxcheck_status").innerHTML=CPANEL.icons.error+" "+CPANEL.lang.ajax_error+": "+CPANEL.lang.ajax_try_again;update_mxcheck_state_ui()}};YAHOO.util.Connect.asyncRequest("GET",CPANEL.urls.json_api(e),d,"");YAHOO.util.Dom.get("change_mxcheck_button").disabled=true;YAHOO.util.Dom.get("mxcheck_status").innerHTML=CPANEL.icons.ajax+" "+LANG.MX_changing};var deselect_mxcheck_ui=function(){YAHOO.util.Dom.get("mxcheck_auto").checked=false;YAHOO.util.Dom.get("mxcheck_local").checked=false;YAHOO.util.Dom.get("mxcheck_secondary").checked=false;YAHOO.util.Dom.get("mxcheck_remote").checked=false;YAHOO.util.Dom.setStyle("mxcheck_auto_label","font-weight","normal");YAHOO.util.Dom.setStyle("mxcheck_local_label","font-weight","normal");YAHOO.util.Dom.setStyle("mxcheck_secondary_label","font-weight","normal");YAHOO.util.Dom.setStyle("mxcheck_remote_label","font-weight","normal");YAHOO.util.Dom.get("mxcheck_auto_current_setting").innerHTML="";YAHOO.util.Dom.get("mxcheck_detected_state_local").innerHTML="";YAHOO.util.Dom.get("mxcheck_detected_state_secondary").innerHTML="";YAHOO.util.Dom.get("mxcheck_detected_state_remote").innerHTML=""};var update_mxcheck_state_ui=function(){var b=YAHOO.util.Dom.get("mxcheck_state").value;var a=YAHOO.util.Dom.get("detected_state").value;YAHOO.util.Dom.get("change_mxcheck_button").disabled=false;deselect_mxcheck_ui();if(b=="auto"||b=="local"||b=="secondary"||b=="remote"){YAHOO.util.Dom.get("mxcheck_"+b).checked=true;YAHOO.util.Dom.setStyle("mxcheck_"+b+"_label","font-weight","bold");if(b=="auto"&&(a=="local"||a=="secondary"||a=="remote")){if(a=="local"){YAHOO.util.Dom.get("mxcheck_auto_current_setting").innerHTML=": "+LANG.MX_Local}else{if(a=="secondary"){YAHOO.util.Dom.get("mxcheck_auto_current_setting").innerHTML=": "+LANG.MX_Backup}else{if(a=="remote"){YAHOO.util.Dom.get("mxcheck_auto_current_setting").innerHTML=": "+LANG.MX_Remote}}}YAHOO.util.Dom.get("mxcheck_detected_state_"+a).innerHTML="("+LANG.MX_current_detected_setting+")"}}};var add_validation=function(){var a=function(){var b=document.getElementById("destination").value;if(CPANEL.validate.ip(b)){return false}return CPANEL.validate.fqdn(b)};VALID.priority=new CPANEL.validate.validator(LANG.MX_priority);VALID.priority.add("priority","positive_integer",LANG.MX_priority_positive_integer);VALID.priority.attach();VALID.destination=new CPANEL.validate.validator(LANG.MX_destination);VALID.destination.add("destination",a,LANG.MX_destination_fqdn);VALID.destination.attach();CPANEL.validate.attach_to_form("submit_mx_record",VALID,add_mx_record)};var toggle_domain=function(){var a=YAHOO.util.Dom.get("domain").value;if(a!="_select_"){CPANEL.animate.slide_down("mx_input_and_table");update_mx_records_table()}else{CPANEL.animate.slide_up("mx_input_and_table")}};var init_page=function(){add_validation();CPANEL.util.catch_enter(["priority","destination"],"submit_mx_record");if(YAHOO.util.Dom.get("domain").value!="_select_"){update_mx_records_table()}};YAHOO.util.Event.onDOMReady(init_page);(function(){var a=[["div.dt_module","display:none"]];var b;var c=document.styleSheets[0];if("insertRule" in c){a.forEach(function(d){c.insertRule(d[0]+" {"+d[1]+"}",0)})}else{a.forEach(function(d){c.addRule(d[0],d[1],0)})}})();
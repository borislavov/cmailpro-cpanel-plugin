if(!self.DEFAULT_QUOTA_SELECTED){var DEFAULT_QUOTA_SELECTED="userdefined"}if(!self.USERDEFINED_QUOTA_DEFAULT_VALUE){var USERDEFINED_QUOTA_DEFAULT_VALUE=250}var ACCOUNTS;var PAGE_DATA;var AJAX_FAILURES=0;var AJAX_FAILURE_ATTEMPTS=3;var TABLE_REQUEST_ACTIVE=false;var TABLE_REQUEST_PENDING=false;var LAST_SEARCH_TXT="";var API;var SORT_STATE;var MENUS=[];var ADD_EMAIL_VALID={};var OPEN_ACTION_DIV=0;var CHANGE_PASSWORD_BAR;var CHANGE_PASSWORD1_VALIDATION;var CHANGE_PASSWORD2_VALIDATION;var CHANGE_QUOTA_VALID={};var AJAX_TIMEOUT_MS=60000;var update_email_accounts=function(){if(TABLE_REQUEST_PENDING){return true}var d=function(j){if(TABLE_REQUEST_ACTIVE==true){setTimeout(function(){d(j)},10)}else{TABLE_REQUEST_PENDING=false;AJAX_FAILURES=0;try{var g=YAHOO.lang.JSON.parse(j.responseText);ACCOUNTS=g.cpanelresult.data;PAGE_DATA=g.cpanelresult.paginate;for(var f=0;f<PAGE_DATA.length;f++){PAGE_DATA[z]=parseInt(PAGE_DATA[z])}if(ACCOUNTS.length>0){build_email_table()}else{show_no_accounts()}}catch(h){json_parse_error()}}};var b=function(j){if(TABLE_REQUEST_ACTIVE==true){setTimeout(function(){b(j)},10)}else{TABLE_REQUEST_PENDING=false;var g=YAHOO.util.Region.getRegion(YAHOO.util.Dom.get("accounts_table"));if(g.height>0){var f='<div style="height: '+g.height+'px"><div style="padding: 20px">';var i="</div></div>"}else{var f='<div style="padding: 20px">';var i="</div>"}if(j.status=="401"){var h=CPANEL.icons.error+" "+LANG.permission_401+"  "+CPANEL.lang.ajax_try_again;YAHOO.util.Dom.get("accounts_table").innerHTML=f+h+i}else{if(AJAX_FAILURES<AJAX_FAILURE_ATTEMPTS){AJAX_FAILURES++;var h=CPANEL.icons.error+" "+LANG.ajax_failure+" "+LANG.retrying_3_seconds;YAHOO.util.Dom.get("accounts_table").innerHTML=f+h+i;setTimeout(update_email_accounts,3000)}else{var h=CPANEL.icons.error+" "+LANG.ajax_failure+" "+CPANEL.lang.ajax_try_again;YAHOO.util.Dom.get("accounts_table").innerHTML=f+h+i}}}};var e={success:function(f){d(f)},failure:function(f){b(f)},timeout:AJAX_TIMEOUT_MS};TABLE_REQUEST_ACTIVE=true;TABLE_REQUEST_PENDING=true;YAHOO.util.Connect.asyncRequest("GET",CPANEL.urls.json_api(API),e,"");var a=YAHOO.util.Region.getRegion(YAHOO.util.Dom.get("accounts_table"));if(a.height>0){YAHOO.util.Dom.get("accounts_table").innerHTML='<div style="height: '+a.height+'px"><div style="padding: 20px">'+CPANEL.icons.ajax+" "+CPANEL.lang.ajax_loading+"</div></div>"}else{YAHOO.util.Dom.get("accounts_table").innerHTML='<div style="padding: 20px">'+CPANEL.icons.ajax+" "+CPANEL.lang.ajax_loading+"</div>"}for(var c=0;c<MENUS.length;c++){if(MENUS[c]){MENUS[c].destroy()}}MENUS=[];if(YAHOO.util.Dom.inDocument(OPEN_ACTION_DIV.id)==true){if(YAHOO.util.Dom.getStyle(OPEN_ACTION_DIV.id,"display")!="none"){before_hide_module(OPEN_ACTION_DIV)}}TABLE_REQUEST_ACTIVE=false};var show_no_accounts=function(){var a='<div id="loading_div" style="padding: 20px; text-align: center">'+LANG.no_accounts_found+"</div>";YAHOO.util.Dom.get("accounts_table").innerHTML=a};var build_email_table=function(){YAHOO.util.Dom.get("accounts_table").innerHTML=build_email_table_markup();build_progress_bars()};var build_email_table_markup=function(){var e="rowA";var d='<table id="table_email_accts" class="table_email_accts" border="0" cellspacing="0" cellpadding="0">';for(var c=0;c<ACCOUNTS.length;c++){if(ACCOUNTS[c]["_diskquota"]==0||ACCOUNTS[c]["diskquota"]=="unlimited"){ACCOUNTS[c]["humandiskquota"]="&infin;"}else{ACCOUNTS[c]["humandiskquota"]=ACCOUNTS[c]["diskquota"]}ACCOUNTS[c]["diskused"]=parseInt(ACCOUNTS[c]["diskused"]);d+='<tr id="account_row_'+c+'" class="dt_info_row '+e+'">';d+='<td class="col1">'+ACCOUNTS[c]["email"]+"</td>";d+='<td class="col2">'+ACCOUNTS[c]["diskused"]+'<input type="hidden" id="diskused_'+c+'" value="'+ACCOUNTS[c]["diskused"]+'" /> / <span id="quota_'+c+'">'+ACCOUNTS[c]["humandiskquota"]+'</span> <span class="megabyte_font">MB</span><br /><div style="height: 3px"></div><div class="table_progress_bar" id="usage_bar_'+c+'"></div></td>';d+='<td class="col3">';d+='<table class="table_email_accts_actions" border="0" cellspacing="0" cellpadding="0"><tr>';d+='<td><span class="action_link" onclick="toggle_action_div(null, {id:\'change_password_module_'+c+"', index:"+c+", action:'change_password'})\">"+LANG.change_password_br+"</span></td>";d+='<td><span class="action_link" onclick="toggle_action_div(null, {id:\'change_quota_module_'+c+"', index:"+c+", action:'change_quota'})\">"+LANG.change_quota_br+"</span></td>";d+='<td><span class="action_link" onclick="toggle_action_div(null, {id:\'delete_module_'+c+"', index:"+c+", action:'delete'})\">"+LANG.delete2+"</span></td>";d+='<td><div onclick="toggle_menu(null, {index:'+c+'})" class="email_table_more_button email_table_more_options" id="email_table_menu_button_'+c+'">'+LANG.More+" "+MORE_IMG+"</div></td>";d+="</tr></table>";d+="</td>";d+="</tr>";d+='<tr id="dt_module_row_'+c+'" class="'+e+'"><td colspan="3">';d+='<div id="change_password_module_'+c+'" class="dt_module" style="display: none"></div>';d+='<div id="change_quota_module_'+c+'" class="dt_module" style="display: none"></div>';d+='<div id="delete_module_'+c+'" class="dt_module" style="display: none"></div>';d+='<div id="status_bar_'+c+'" class="cjt_status_bar" style="padding: 15px 0px 20px 0px"></div>';d+="</td></tr>";if(e==="rowA"){e="rowB"}else{e="rowA"}}d+="</table>";d+='<div id="pagination">';if(PAGE_DATA.total_pages>1){var b=0;var a=0;d+='<div id="pagination_pages">';for(var c=1;c<=PAGE_DATA.total_pages;c++){if(c==PAGE_DATA.current_page){d+=' <span id="email_table_page_'+c+'" class="email_table_current_page">'+c+"</span> "}else{if(c==1||c==PAGE_DATA.total_pages){d+=' <span class="email_table_page" onclick="change_page('+c+')">'+c+"</span> "}else{if(c<PAGE_DATA.current_page-2){if(b==0){d+="...";b=1}}else{if(c>PAGE_DATA.current_page+2){if(a==0){d+="...";a=1}}else{d+=' <span onclick="change_page('+c+')" class="email_table_page">'+c+"</span> "}}}}}d+="</div>";d+='<div id="pagination_links">';if(PAGE_DATA.current_page!=1){d+='<span onclick="change_page('+(PAGE_DATA.current_page-1)+')" class="email_table_prev_page">&larr; '+LANG.prev+"</span> "}if(PAGE_DATA.current_page!=PAGE_DATA.total_pages){d+=' <span onclick="change_page('+(parseInt(PAGE_DATA.current_page)+1)+')" class="email_table_next_page">'+LANG.next+" &rarr;</span>"}d+="</div>"}d+="</div>";return d};var build_progress_bars=function(){for(var a=0;a<ACCOUNTS.length;a++){build_progress_bar("usage_bar_"+a,ACCOUNTS[a]["diskused"],ACCOUNTS[a]["diskquota"])}};var build_progress_bar=function(d,c,b){var a=100*(c/b);if(b==0){a=0}CPANEL.widgets.progress_bar(d,a,"",{inverse_colors:true})};var change_page=function(a){API.api2_paginate_start=((a-1)*PAGE_DATA.results_per_page)+1;update_email_accounts()};var toggle_menu=function(c,d){if(typeof(MENUS[d.index])!=="object"){var a={position:"dynamic",clicktohide:"true",context:["email_table_menu_button_"+d.index,"tl","bl",["beforeShow","windowResize",CPANEL.align_panels_event]],shadow:"true",effect:{effect:YAHOO.widget.ContainerEffect.FADE,duration:0.25}};MENUS[d.index]=new YAHOO.widget.Menu("email_table_menu_"+d.index,a);var b=[];if(WEBMAIL_ENABLED==true){b.push({text:LANG.access_webmail,url:"webmailform.html?user="+encodeURIComponent(ACCOUNTS[d.index]["user"])+"@"+encodeURIComponent(ACCOUNTS[d.index]["domain"])+"&amp;domain="+encodeURIComponent(ACCOUNTS[d.index]["domain"]),target:"_blank"})}b.push({text:LANG.configure_email_client,url:"clientconf.html?acct="+encodeURIComponent(ACCOUNTS[d.index]["user"])+"@"+encodeURIComponent(ACCOUNTS[d.index]["domain"])});MENUS[d.index].addItems(b);MENUS[d.index].render("menus_div")}MENUS[d.index].show()};var toggle_action_div=function(b,c){if(OPEN_ACTION_DIV&&OPEN_ACTION_DIV.id!==c.id&&YAHOO.util.Dom.getStyle(OPEN_ACTION_DIV.id,"display")!="none"){var a=OPEN_ACTION_DIV;before_hide_module(a);CPANEL.animate.slide_up(a.id,function(){after_hide_module(a)})}if(YAHOO.util.Dom.getStyle(c.id,"display")!="none"){before_hide_module(c);CPANEL.animate.slide_up(c.id,function(){after_hide_module(c)})}else{before_show_module(c);CPANEL.animate.slide_down(c.id,function(){after_show_module(c)});OPEN_ACTION_DIV=c}};var before_show_module=function(c){var b=YAHOO.util.Dom.get(c.id);if(b.innerHTML==""){var a="";if(c.action=="change_password"){a+='<table style="width: 500px; text-align: center; padding: 8px 0px; margin: 0px auto">';a+="<tr>";a+='<td width="33%" style="text-align: right">'+LANG.password+":</td>";a+='<td width="33%"><input type="password" id="change_password_input_1_'+c.index+'" style="width: 150px" /></td>';a+='<td width="33%" style="text-align: left"><span id="change_password_input_1_'+c.index+'_error" style="width: 16px; height: 16px;"></span></td>';a+="</tr>";a+="<tr>";a+='<td style="text-align: right">'+LANG.password2+":</td>";a+='<td><input type="password" id="change_password_input_2_'+c.index+'" style="width: 150px" /></td>';a+='<td style="text-align: left"><span id="change_password_input_2_'+c.index+'_error" style="width: 16px; height: 16px;"></span></td>';a+="</tr>";a+="<tr>";a+='<td style="text-align: right">'+LANG.strength+":</td>";a+='<td><center><div id="password_strength_bar_'+c.index+'" style="width: 150px; height: 20px; border: 1px solid black"></center></div></td>';a+='<td style="text-align: left"><input type="button" class="input-button" tabindex="-1" id="create_strong_password_'+c.index+'" value="'+CPANEL.lang.password_generator+'" /></td>';a+="</tr>";a+='<tr><td colspan="3">';a+='<div style="height: 8px">&nbsp;</div>';a+='<div id="change_password_input_'+c.index+'">';a+='<span class="action_link" id="email_table_change_password_cancel_'+c.index+'">'+CPANEL.lang.cancel+"</span> or ";a+='<input type="button" class="input-button" value="'+LANG.change_password+'" id="email_table_change_password_confirm_'+c.index+'" />';a+="</div>";a+='<div id="change_password_status_'+c.index+'"></div>';a+="</td></tr>";a+="</table>"}if(c.action=="change_quota"){a+='<table style="width: 500px; margin: 0px auto">';a+="<tr>";a+='<td width="45%" style="text-align: right">'+LANG.mailbox_quota+": </td>";a+='<td width="55%" style="text-align: left">';a+='<input type="hidden" id="current_quota_'+c.index+'" value="'+ACCOUNTS[c.index]["diskquota"]+'" />';a+='<span id="current_quota_'+c.index+'_error" style="display: none"></span>';if(ACCOUNTS[c.index]["diskquota"]=="unlimited"){a+='<input type="radio" name="quota_'+c.index+'" id="quota_number_'+c.index+'" />&nbsp;<input type="text" id="quota_number_input_'+c.index+'" size="4" maxlength="4" value="'+USERDEFINED_QUOTA_DEFAULT_VALUE+'" style="color: #888888;" /> <span class="megabyte_font">MB</span> <span id="quota_number_input_'+c.index+'_error"></span><br />';a+='<input type="radio" name="quota_'+c.index+'" id="quota_unlimited_'+c.index+'" checked="checked" />&nbsp;<label style="display: inline" for="quota_unlimited_'+c.index+'">'+LANG.Unlimited+'</label>&nbsp;<span id="quota_unlimited_'+c.index+'_error"></span>'}else{a+='<input type="radio" name="quota_'+c.index+'" id="quota_number_'+c.index+'" checked="checked" />&nbsp;<input type="text" id="quota_number_input_'+c.index+'" size="4" maxlength="4" value="'+ACCOUNTS[c.index]["diskquota"]+'"/> <span class="megabyte_font">MB</span> <span id="quota_number_input_'+c.index+'_error" ></span><br />';a+='<input type="radio" name="quota_'+c.index+'" id="quota_unlimited_'+c.index+'" />&nbsp;<label style="display: inline" for="quota_unlimited_'+c.index+'">'+LANG.Unlimited+'</label>&nbsp;<span id="quota_unlimited_'+c.index+'_error" ></span>'}a+="</td>";a+="</tr>";a+='<tr><td colspan="2" style="text-align: center">';a+='<div style="height: 4px">&nbsp;</div>';a+='<div id="change_quota_input_'+c.index+'">';a+='<span class="action_link" id="email_table_change_quota_cancel_'+c.index+'">'+CPANEL.lang.cancel+"</span> or ";a+='<input type="button" class="input-button" value="'+LANG.change_quota+'" id="change_quota_confirm_'+c.index+'" />';a+="</div>";a+='<div id="change_quota_status_'+c.index+'"></div>';a+="</td></tr>";a+="</table>"}if(c.action=="delete"){a+='<div style="width: 500px; margin: 0px auto; padding: 8px 0px; text-align: center">';a+=LANG.delete2+" "+ACCOUNTS[c.index]["email"]+" ?<br /><br />";a+='<div id="delete_confirm_input_'+c.index+'">';a+='<span class="action_link" id="email_table_delete_cancel_'+c.index+'">'+CPANEL.lang.cancel+"</span> or ";a+='<input type="button" class="input-button" id="email_table_delete_confirm_'+c.index+'" value="'+LANG.delete2+'" /></span>';a+="</div>";a+='<div id="delete_email_status_'+c.index+'"></div>';a+="</div>"}b.innerHTML=a}};var after_show_module=function(e){if(e.action=="change_password"){var d="change_password_input_1_"+e.index;var b="change_password_input_2_"+e.index;YAHOO.util.Event.on("email_table_change_password_confirm_"+e.index,"click",change_password,{index:e.index});YAHOO.util.Event.on("create_strong_password_"+e.index,"click",create_strong_password,{index:e.index});YAHOO.util.Event.on("email_table_change_password_cancel_"+e.index,"click",toggle_action_div,e);CPANEL.util.catch_enter([d,b],"email_table_change_password_confirm_"+e.index);CHANGE_PASSWORD1_VALIDATION=new CPANEL.validate.validator(LANG.change_password);CHANGE_PASSWORD1_VALIDATION.add(d,verify_password_strength,CPANEL.lang.password_validator_strength+" "+REQUIRED_PASSWORD_STRENGTH+".");CHANGE_PASSWORD1_VALIDATION.add(d,'no_chars(%input%, " ")',CPANEL.lang.password_validator_no_spaces);CHANGE_PASSWORD1_VALIDATION.attach();CHANGE_PASSWORD2_VALIDATION=new CPANEL.validate.validator(CPANEL.lang.passwords_match);CHANGE_PASSWORD2_VALIDATION.add(b,"equals('"+d+"', '"+b+"')",CPANEL.lang.password_validator_no_match);CHANGE_PASSWORD2_VALIDATION.attach();CHANGE_PASSWORD_BAR=new CPANEL.password.strength_bar("password_strength_bar_"+e.index);CHANGE_PASSWORD_BAR.attach(d,function(){CHANGE_PASSWORD1_VALIDATION.verify()});YAHOO.util.Dom.get(d).focus()}if(e.action=="change_quota"){var a=YAHOO.util.Dom.get("quota_number_"+e.index);var f=YAHOO.util.Dom.get("quota_number_input_"+e.index);var c=YAHOO.util.Dom.get("quota_unlimited_"+e.index);CHANGE_QUOTA_VALID.quota_number=new CPANEL.validate.validator(LANG.change_quota);CHANGE_QUOTA_VALID.quota_number.add(f,"positive_integer",LANG.email_quota_number,"quota_number_"+e.index);CHANGE_QUOTA_VALID.quota_number.add(f,function(){return quota_over_2gigs(f)},LANG.email_quota_2gig,"quota_number_"+e.index);CHANGE_QUOTA_VALID.quota_number.attach();CHANGE_QUOTA_VALID.quota_unlimited=new CPANEL.validate.validator(LANG.change_quota);CHANGE_QUOTA_VALID.quota_unlimited.add("quota_unlimited_"+e.index,"anything","","quota_unlimited_"+e.index);CHANGE_QUOTA_VALID.quota_unlimited.attach();CHANGE_QUOTA_VALID.content_changed=new CPANEL.validate.validator(LANG.change_quota);CHANGE_QUOTA_VALID.content_changed.add("current_quota_"+e.index,function(){return change_quota_content(e.index)},LANG.must_change_before_edit);CHANGE_QUOTA_VALID.content_changed.attach();YAHOO.util.Event.on("email_table_change_quota_cancel_"+e.index,"click",toggle_action_div,e);YAHOO.util.Event.on(c,"click",function(){click_quota_unlimited(f,CHANGE_QUOTA_VALID.quota_number,CHANGE_QUOTA_VALID.quota_unlimited)});YAHOO.util.Event.on([a,f],"click",function(){click_quota_number(a,f,CHANGE_QUOTA_VALID.quota_number,CHANGE_QUOTA_VALID.quota_unlimited)});CPANEL.util.catch_enter("quota_number_input_"+e.index,"change_quota_confirm_"+e.index);CPANEL.validate.attach_to_form("change_quota_confirm_"+e.index,CHANGE_QUOTA_VALID,function(){change_quota(e.index)})}if(e.action=="delete"){YAHOO.util.Event.on("email_table_delete_confirm_"+e.index,"click",delete_confirm,{index:e.index});YAHOO.util.Event.on("email_table_delete_cancel_"+e.index,"click",toggle_action_div,e)}};var before_hide_module=function(b){if(b.action=="change_password"&&CHANGE_PASSWORD1_VALIDATION.clear_messages&&CHANGE_PASSWORD2_VALIDATION.clear_messages&&CHANGE_PASSWORD_BAR.destroy){CHANGE_PASSWORD1_VALIDATION.clear_messages();CHANGE_PASSWORD2_VALIDATION.clear_messages();CHANGE_PASSWORD_BAR.destroy()}if(b.action=="change_quota"){for(var a in CHANGE_QUOTA_VALID){if(CHANGE_QUOTA_VALID.hasOwnProperty(a)){CHANGE_QUOTA_VALID[a].clear_messages()}}}};var after_hide_module=function(a){if(a.action==="change_password"){YAHOO.util.Dom.get("change_password_input_1_"+a.index).value="";YAHOO.util.Dom.get("change_password_input_2_"+a.index).value=""}YAHOO.util.Event.purgeElement(a.id,true)};var verify_password_strength=function(){if(CHANGE_PASSWORD_BAR.current_strength<REQUIRED_PASSWORD_STRENGTH){return false}else{return true}};var create_strong_password=function(a,b){CPANEL.password.generate_password(function(c){YAHOO.util.Dom.get("change_password_input_1_"+b.index).value=c;YAHOO.util.Dom.get("change_password_input_2_"+b.index).value=c;CHANGE_PASSWORD_BAR.check_strength("change_password_input_1_"+b.index,function(){CHANGE_PASSWORD1_VALIDATION.verify()});CHANGE_PASSWORD2_VALIDATION.verify()})};var delete_confirm=function(d,f){var b=f.index;var h={cpanel_jsonapi_version:2,cpanel_jsonapi_module:"Email",cpanel_jsonapi_func:"delpop",email:ACCOUNTS[f.index].user,domain:ACCOUNTS[f.index].domain};var a=function(){YAHOO.util.Dom.get("delete_email_status_"+b).innerHTML="";YAHOO.util.Dom.setStyle("delete_confirm_input_"+b,"display","block");toggle_action_div(null,{id:"delete_module_"+b,index:b,action:"delete"})};var c=function(){var j=YAHOO.util.Dom.getElementsByClassName("dt_info_row","tr","table_email_accts");var k=true;for(var e=0;e<j.length;e++){if(YAHOO.util.Dom.getStyle(j[e],"display")!="none"){k=false}}if(k==true){show_no_accounts()}};var g={success:function(k){try{var i=YAHOO.lang.JSON.parse(k.responseText);if(i.cpanelresult["data"][0]["result"]=="1"){CPANEL.animate.fade_out("account_row_"+b,function(){YAHOO.util.Dom.setStyle("module_row_"+b,"display","none");c()});CPANEL.animate.fade_out("delete_module_"+b)}else{if(i.cpanelresult["data"][0]["result"]==0){a();CPANEL.widgets.status_bar("status_bar_"+b,"error",CPANEL.lang.Error,i.cpanelresult["data"][0]["reason"])}else{a();CPANEL.widgets.status_bar("status_bar_"+b,"error",CPANEL.lang.Error,"Unknown error.")}}}catch(j){a();CPANEL.widgets.status_bar("status_bar_"+b,"error",CPANEL.lang.json_error,CPANEL.lang.json_parse_failed)}},failure:function(e){a();CPANEL.widgets.status_bar("status_bar_"+b,"error",CPANEL.lang.ajax_error,CPANEL.lang.ajax_try_again)}};YAHOO.util.Connect.asyncRequest("GET",CPANEL.urls.json_api(h),g,"");YAHOO.util.Dom.setStyle("delete_confirm_input_"+b,"display","none");YAHOO.util.Dom.get("delete_email_status_"+b).innerHTML=CPANEL.icons.ajax+" "+LANG.deleting+"..."};var json_parse_error=function(){var b=CPANEL.icons.error+" "+CPANEL.lang.json_parse_failed+"  "+CPANEL.lang.ajax_try_again;var a=YAHOO.util.Region.getRegion(YAHOO.util.Dom.get("accounts_table"));if(a.height>0){YAHOO.util.Dom.get("accounts_table").innerHTML='<div style="height: '+a.height+'px"><div style="padding: 20px">'+b+"</div></div>"}else{YAHOO.util.Dom.get("accounts_table").innerHTML='<div style="padding: 20px">'+b+"</div>"}};var change_quota_content=function(b){var a=YAHOO.util.Dom.get("current_quota_"+b).value;if(YAHOO.util.Dom.get("quota_number_"+b).checked==true){return a!=YAHOO.util.Dom.get("quota_number_input_"+b).value}else{if(a=="0"){return false}if(a==CPANEL.lang.unlimited){return false}return true}};var change_quota=function(a){var b=0;if(YAHOO.util.Dom.get("quota_number_"+a).checked){b=YAHOO.util.Dom.get("quota_number_input_"+a).value}var d={cpanel_jsonapi_version:2,cpanel_jsonapi_module:"Email",cpanel_jsonapi_func:"editquota",email:ACCOUNTS[a]["user"],domain:ACCOUNTS[a]["domain"],quota:b};var c={success:function(j){YAHOO.util.Dom.get("change_quota_status_"+a).innerHTML="";YAHOO.util.Dom.setStyle("change_quota_input_"+a,"display","block");toggle_action_div(null,{id:"change_quota_module_"+a,index:a,action:"change_quota"});try{var h=YAHOO.lang.JSON.parse(j.responseText)}catch(i){CPANEL.widgets.status_bar("status_bar_"+a,"error",CPANEL.lang.json_error,CPANEL.lang.json_parse_failed);return}if(h.cpanelresult.data[0].result==1){var g=d.quota;if(d.quota==0){g="&infin;"}YAHOO.util.Dom.get("quota_"+a).innerHTML=g;YAHOO.util.Dom.get("current_quota_"+a).value=(d.quota=="unlimited"?"unlimited":d.quota);var f=g+' <span class="megabyte_font">MB</span>';if(d.quota==0){f=CPANEL.lang.unlimited}CPANEL.widgets.status_bar("status_bar_"+a,"success",LANG.Changed_Quota,f);build_progress_bar("usage_bar_"+a,YAHOO.util.Dom.get("diskused_"+a).value,d.quota)}else{if(h.cpanelresult.data[0].result==0){CPANEL.widgets.status_bar("status_bar_"+a,"error",CPANEL.lang.Error,h.cpanelresult.data[0].reason)}else{CPANEL.widgets.status_bar("status_bar_"+a,"error",CPANEL.lang.Error,LANG.unknown_error)}}},failure:function(e){YAHOO.util.Dom.get("change_quota_status_"+a).innerHTML="";YAHOO.util.Dom.setStyle("change_quota_input_"+a,"display","block");toggle_action_div(null,{id:"change_quota_module_"+a,index:a,action:"change_quota"});CPANEL.widgets.status_bar("status_bar_"+a,"error",CPANEL.lang.ajax_error,CPANEL.lang.ajax_try_again)}};YAHOO.util.Connect.asyncRequest("GET",CPANEL.urls.json_api(d),c,"");YAHOO.util.Dom.setStyle("change_quota_input_"+a,"display","none");YAHOO.util.Dom.get("change_quota_status_"+a).innerHTML=CPANEL.icons.ajax+" "+LANG.changing_quota+"..."};var change_password=function(c,d){var b=d.index;CHANGE_PASSWORD1_VALIDATION.verify();CHANGE_PASSWORD2_VALIDATION.verify();var h=[];if(CHANGE_PASSWORD1_VALIDATION.is_valid()==false){h.push(CHANGE_PASSWORD1_VALIDATION.error_messages())}if(CHANGE_PASSWORD2_VALIDATION.is_valid()==false){h.push(CHANGE_PASSWORD2_VALIDATION.error_messages())}if(h.length>0){CPANEL.validate.show_modal_error(h)}else{var a=YAHOO.util.Dom.get("change_password_input_1_"+d.index).value;var g={cpanel_jsonapi_version:2,cpanel_jsonapi_module:"Email",cpanel_jsonapi_func:"passwdpop",email:ACCOUNTS[d.index]["user"],domain:ACCOUNTS[d.index]["domain"],password:a};var f={success:function(k){YAHOO.util.Dom.setStyle("change_password_input_"+b,"display","block");YAHOO.util.Dom.get("change_password_status_"+b).innerHTML="";toggle_action_div(null,{id:"change_password_module_"+b,index:b,action:"change_password"});try{var i=YAHOO.lang.JSON.parse(k.responseText);if(i.cpanelresult["data"][0]["result"]=="1"){CPANEL.widgets.status_bar("status_bar_"+b,"success",LANG.password_changed)}else{CPANEL.widgets.status_bar("status_bar_"+b,"error",CPANEL.lang.Error,i.cpanelresult["error"])}}catch(j){CPANEL.widgets.status_bar("status_bar_"+b,"error",CPANEL.lang.json_error,CPANEL.lang.json_parse_failed)}},failure:function(e){YAHOO.util.Dom.setStyle("change_password_input_"+b,"display","block");YAHOO.util.Dom.get("change_password_status_"+b).innerHTML="";toggle_action_div(null,{id:"change_password_module_"+b,index:b,action:"change_password"});CPANEL.widgets.status_bar("status_bar_"+b,"error",CPANEL.lang.ajax_error,CPANEL.lang.ajax_try_again)}};YAHOO.util.Connect.asyncRequest("GET",CPANEL.urls.json_api(g),f,"");YAHOO.util.Dom.setStyle("change_password_input_"+b,"display","none");YAHOO.util.Dom.get("change_password_status_"+b).innerHTML=CPANEL.icons.ajax+" "+LANG.changing_password+"..."}};var reset_pagination=function(){API.api2_paginate_start=1};var toggle_items_per_page=function(){if(TABLE_REQUEST_PENDING){return true}var a=YAHOO.util.Dom.get("email_table_items_per_page");API.api2_paginate_size=a.options[a.selectedIndex].text;reset_pagination();update_email_accounts()};var search_input_focus=function(){var a=YAHOO.util.Dom.get("email_table_search_input");if(a.value==LANG.search_email){a.value=""}};var search_input_blur=function(){var a=YAHOO.util.Dom.get("email_table_search_input");if(a.value==""){a.value=LANG.search_email;YAHOO.util.Dom.setStyle("email_table_clear_search","display","none")}};var search_email=function(){if(TABLE_REQUEST_PENDING){return true}var a=YAHOO.util.Dom.get("email_table_search_input").value;if(a==LANG.search_email){a=""}if(a==LAST_SEARCH_TXT){return true}LAST_SEARCH_TXT=a;API.api2_filter=1;API.api2_filter_type="contains";API.api2_filter_column="email";API.api2_filter_term=a;reset_pagination();update_email_accounts();if(a!=""){YAHOO.util.Dom.setStyle("email_table_clear_search","display","")}};var clear_search=function(){YAHOO.util.Dom.get("email_table_search_input").value="";search_input_blur();API.api2_filter=1;API.api2_filter_type="contains";API.api2_filter_column="email";API.api2_filter_term="";LAST_SEARCH_TXT="";update_email_accounts()};var toggle_sort=function(a,b){if(TABLE_REQUEST_PENDING){return true}YAHOO.util.Dom.get("email_table_account_sort_img").innerHTML="";YAHOO.util.Dom.get("email_table_domain_sort_img").innerHTML="";YAHOO.util.Dom.get("email_table_usage_sort_img").innerHTML="";YAHOO.util.Dom.get("email_table_quota_sort_img").innerHTML="";YAHOO.util.Dom.get("email_table_percent_sort_img").innerHTML="";if(b.header=="percent"){API.api2_sort_column="diskusedpercent";API.api2_sort_method="numeric"}if(b.header=="account"){API.api2_sort_column="user";API.api2_sort_method="alphabet"}if(b.header=="domain"){API.api2_sort_column="domain";API.api2_sort_method="alphabet"}if(b.header=="usage"){API.api2_sort_column="_diskused";API.api2_sort_method="numeric"}if(b.header=="quota"){API.api2_sort_column="_diskquota";API.api2_sort_method="numeric_zero_as_max"}if(SORT_STATE[b.header]=="asc"){YAHOO.util.Dom.get("email_table_"+b.header+"_sort_img").innerHTML="&darr;";SORT_STATE[b.header]="desc";API.api2_sort_reverse="1"}else{YAHOO.util.Dom.get("email_table_"+b.header+"_sort_img").innerHTML="&uarr;";SORT_STATE[b.header]="asc";API.api2_sort_reverse="0"}reset_pagination();update_email_accounts()};var initialize_new_email_validators=function(){ADD_EMAIL_VALID.account=new CPANEL.validate.validator(LANG.account_name);ADD_EMAIL_VALID.account.add("add_email_account","local_part_email(%input%, 'cpanel')",LANG.not_valid_email);ADD_EMAIL_VALID.account.add("add_email_account","max_length(%input%, 128)",LANG.email_max_128_char);ADD_EMAIL_VALID.account.attach();var a=CPANEL.password.setup("add_email_password1","add_email_password2","password_strength",REQUIRED_PASSWORD_STRENGTH,"create_strong_password","why_strong_passwords_link","why_strong_passwords_text");ADD_EMAIL_VALID.password1=a[0];ADD_EMAIL_VALID.password2=a[1];ADD_EMAIL_VALID.quota_number=new CPANEL.validate.validator(LANG.Quota);ADD_EMAIL_VALID.quota_number.add("quota_number_input","positive_integer",LANG.email_quota_number,"quota_number");ADD_EMAIL_VALID.quota_number.add("quota_number_input",function(){return quota_over_2gigs("quota_number_input")},LANG.email_quota_2gig,"quota_number");ADD_EMAIL_VALID.quota_number.attach();ADD_EMAIL_VALID.quota_unlimited=new CPANEL.validate.validator(LANG.Quota);ADD_EMAIL_VALID.quota_unlimited.add("quota_unlimited","anything","","quota_unlimited");ADD_EMAIL_VALID.quota_unlimited.attach()};var quota_over_2gigs=function(a){var b=YAHOO.util.Dom.get(a).value;if(CPANEL.validate.integer(b)==true&&b>2048){return false}return true};var reset_add_account_form=function(){YAHOO.util.Dom.get("add_email_account").value="";YAHOO.util.Dom.get("add_email_password1").value="";YAHOO.util.Dom.get("add_email_password2").value="";YAHOO.util.Dom.get("quota_number_input").value=""+USERDEFINED_QUOTA_DEFAULT_VALUE+"";YAHOO.util.Dom.get("quota_number_input").disabled=false;if(!DEFAULT_QUOTA_SELECTED||DEFAULT_QUOTA_SELECTED=="userdefined"){YAHOO.util.Dom.get("quota_number").checked=true;YAHOO.util.Dom.get("quota_unlimited").checked=false}else{YAHOO.util.Dom.get("quota_number").checked=false;YAHOO.util.Dom.get("quota_unlimited").checked=true}for(var a in ADD_EMAIL_VALID){if(ADD_EMAIL_VALID.hasOwnProperty(a)){ADD_EMAIL_VALID[a].clear_messages()}}CPANEL.password.show_strength_bar("password_strength",0);YAHOO.util.Dom.get("add_email_create_status").innerHTML="";YAHOO.util.Dom.setStyle("add_email_create","display","block");YAHOO.util.Dom.get("add_email_account").focus()};var add_new_email=function(){var b=YAHOO.util.Dom.get("add_email_account").value;var d=YAHOO.util.Dom.get("add_email_domain").value;var a=YAHOO.util.Dom.get("add_email_password1").value;var c=0;if(YAHOO.util.Dom.get("quota_number").checked){c=YAHOO.util.Dom.get("quota_number_input").value}var f={cpanel_jsonapi_version:2,cpanel_jsonapi_module:"Email",cpanel_jsonapi_func:"addpop",email:b,password:a,quota:c,domain:d};var e={success:function(j){reset_add_account_form();try{var h=YAHOO.lang.JSON.parse(j.responseText)}catch(i){CPANEL.widgets.status_bar("add_email_status_bar","error",CPANEL.lang.json_error,CPANEL.lang.json_parse_failed);return}if(h.cpanelresult.data[0].result==1){var g=f.email+"@"+f.domain;CPANEL.widgets.status_bar("add_email_status_bar","success",LANG.account_created,g);update_email_accounts();return}if(h.cpanelresult.data[0].result==0){CPANEL.widgets.status_bar("add_email_status_bar","error",CPANEL.lang.Error,h.cpanelresult.data[0].reason);return}CPANEL.widgets.status_bar("add_email_status_bar","error",CPANEL.lang.Error,LANG.unknown_error)},failure:function(g){reset_add_account_form();CPANEL.widgets.status_bar("add_email_status_bar","error",CPANEL.lang.ajax_error,CPANEL.lang.ajax_try_again)}};YAHOO.util.Connect.asyncRequest("GET",CPANEL.urls.json_api(f),e,"");YAHOO.util.Dom.setStyle("add_email_create","display","none");YAHOO.util.Dom.get("add_email_create_status").innerHTML=CPANEL.icons.ajax+" "+LANG.creating_account+"..."};var click_quota_unlimited=function(a,b,c){YAHOO.util.Dom.setStyle(a,"color","#888888");b.clear_messages();c.verify()};var click_quota_number=function(b,a,c,d){YAHOO.util.Dom.setStyle(a,"color","black");YAHOO.util.Dom.get(b).checked=true;d.clear_messages();c.verify()};var grab_default_account_disk_used=function(){var a={success:function(b){YAHOO.util.Dom.get("default_account_disk_used").innerHTML=b.responseText},failure:function(b){}};YAHOO.util.Connect.asyncRequest("GET","default_account_disk_usage.html",a,"")};var init_mail=function(){API={cpanel_jsonapi_version:2,cpanel_jsonapi_func:"listpopswithdisk",cpanel_jsonapi_module:"CommuniGate",no_validate:1,api2_paginate:1,api2_paginate_size:10,api2_paginate_start:1,api2_sort:1,api2_sort_column:"user",api2_sort_method:"alphabet",api2_sort_reverse:0};SORT_STATE={percent:"asc",account:"asc",domain:"asc",usage:"asc",quota:"asc"};initialize_new_email_validators();var a=YAHOO.util.Dom.get("email_table_items_per_page");API.api2_paginate_size=a.options[a.selectedIndex].text;YAHOO.util.Dom.get("email_table_search_input").value="";search_input_blur();CPANEL.validate.attach_to_form("add_email_create",ADD_EMAIL_VALID,add_new_email);YAHOO.util.Event.on("quota_unlimited","click",function(){click_quota_unlimited("quota_number_input",ADD_EMAIL_VALID.quota_number,ADD_EMAIL_VALID.quota_unlimited)});YAHOO.util.Event.on(["quota_number","quota_number_input"],"click",function(){click_quota_number("quota_number","quota_number_input",ADD_EMAIL_VALID.quota_number,ADD_EMAIL_VALID.quota_unlimited)});CPANEL.util.catch_enter(["add_email_account","add_email_password1","add_email_password2","quota_number_input"],"add_email_create");YAHOO.util.Event.on("email_table_items_per_page","change",toggle_items_per_page);YAHOO.util.Event.on("email_table_search_input","focus",search_input_focus);YAHOO.util.Event.on("email_table_search_input","blur",search_input_blur);CPANEL.util.catch_enter("email_table_search_input",search_email);YAHOO.util.Event.on("email_table_search_button","click",search_email);YAHOO.util.Event.on("email_table_account_sort","click",toggle_sort,{header:"account"});YAHOO.util.Event.on("email_table_domain_sort","click",toggle_sort,{header:"domain"});YAHOO.util.Event.on("email_table_usage_sort","click",toggle_sort,{header:"usage"});YAHOO.util.Event.on("email_table_quota_sort","click",toggle_sort,{header:"quota"});YAHOO.util.Event.on("email_table_percent_sort","click",toggle_sort,{header:"percent"});update_email_accounts();grab_default_account_disk_used()};YAHOO.util.Event.onDOMReady(init_mail);

var Rows_Data;var Ancestry={};var Path_Data={};var TABLE_TEMPLATE="";var Expanding={};var Expanded_Rows={};var EXPANDER_IMG_TEMPLATE=document.getElementById("expander_img_template").text.trim();var NONEXPANDER_IMG_TEMPLATE=document.getElementById("nonexpander_img_template").text.trim();var DIRS_TABLE_ROW_TEMPLATE=document.getElementById("dirs_table_row_template").text.trim();var DIRS_OTHER_OWNER_TABLE_ROW_TEMPLATE=document.getElementById("dirs_other_owner_table_row_template").text.trim();var DIRS_UNTRAVERSIBLE_TABLE_ROW_TEMPLATE=document.getElementById("dirs_untraversible_table_row_template").text.trim();var Utility_Fragment=document.createDocumentFragment();function build_row_html(c,l,f){var p=c.name;c.contained_usage=parseInt(c.contained_usage)||0;var q=l?l+"/"+p:p;var b=q.match(/\//g);var e=b?b.length:0;var r=q.html_encode();var g=!!c.contents&&c.contents!=="0";var k="";for(var d=0;d<e;d++){k+=SPACER}var j=(q in Expanded_Rows)?MINUS_IMAGE_HTML:PLUS_IMAGE_HTML;var a;if(g){a=YAHOO.lang.substitute(EXPANDER_IMG_TEMPLATE,{path:r,img_src:j})}else{a=NONEXPANDER_IMG_TEMPLATE}var h;if(c.traversible){var o=parseInt(c.contained_usage)||0;var n=(o/1048576).toFixed(2);var m=(c.owner===USER)?DIRS_TABLE_ROW_TEMPLATE:DIRS_OTHER_OWNER_TABLE_ROW_TEMPLATE;h=YAHOO.lang.substitute(m,{dir_name:p.html_encode(),path:r,path_uri:encodeURIComponent(q).html_encode(),expander_html:a,indentation_html:k,formatted_bytes:n,raw_bytes:o,owner:c.owner.html_encode()})}else{h=YAHOO.lang.substitute(DIRS_UNTRAVERSIBLE_TABLE_ROW_TEMPLATE,{dir_name:p.html_encode(),path:r,path_uri:encodeURIComponent(q).html_encode(),expander_html:a,indentation_html:k,owner:c.owner.html_encode()})}if(e&&!f){h=h.replace(/<tr\s/i,'<tr style="display:none" ')}Path_Data[q]=c;return[q,h]}function build_dom_rows_html(a,c,g,f){a.sort_by(g);var e=(c==="")?"":c+"/";if(!(c in Ancestry)){var j=[];for(var h=0;h<a.length;h++){j.push(e+a[h].name)}Ancestry[c]=j}var b=[];for(var h=0;h<a.length;h++){var i=a[h];if(i.name!=="."){b.push(build_row_html(i,c,f));if(("contents" in i)&&(i.contents instanceof Array)){b.push.apply(b,build_dom_rows_html(i.contents,e+i.name,g,f))}}}return b}function build_dom_rows(){var e=build_dom_rows_html.apply(this,arguments);var d=e.length;var k=[];var c=[];for(var a=0;a<d;a++){var g=e[a];k.push(g.shift());c.push(g.shift())}c=c.join("");var h="<table>"+c+"</table>";var b=build_dom_rows.utility_container;b.innerHTML=h;var f=b.firstChild.rows;var j=[];for(var a=0;a<d;a++){var i=f[a];Path_Data[k[a]].dom_object=i;j[a]=i}return j}build_dom_rows.utility_container=document.createElement("div");function du_callback(p){var U=p[0].homedir;var k=0;var q=parseInt(U.contained_usage)||0;var o=parseInt(U.user_contained_usage)||0;var I=parseInt(p[0].quotaused)||0;var m=I&&(I-o);var ad=q;var B={};var L=U.contents;var f=L.length;for(var ac=0;ac<f;ac++){var E=L[ac];var l=E.name;var h=parseInt(E.contained_usage)||0;if(l in GRAPH_DIRS){B[l]=h}else{k+=(h||0)}ad-=(h||0)}var P=[" "+LANG.no_subdir];var Y=[ad];var A=CPANEL.util.keys(GRAPH_DIRS).sort();var D=A.length;for(var ab=0;ab<D;ab++){var y=A[ab];if(y in B){P.push("/"+y);Y.push(B[y])}}P.push("/"+LANG.other_subs);Y.push(k);var S=['<a title="'+LANG.see_mysql+'" href="../sql/">MySQL</a>'];Y.push(parseInt(p[0].mysql)||0);if(has_postgres){S.push('<a title="'+LANG.see_pgsql+'" href="../psql/">PostgreSQL</a>');Y.push(parseInt(p[0].pgsql)||0)}if(I){if(m<0){if(("console" in window)&&console.log){console.log("Reported quota usage ("+I+") is less than counted user-owned home directory usage ("+o+"). Setting ???Other??? graph figure to zero.")}Y.push(0)}else{Y.push(m)}S.push(LANG.other)}P.push.apply(P,S);var G=(parseInt(p[0].mysql)||0)+(has_postgres?(parseInt(p[0].pgsql)||0):0);var s=q+G;if(m>0){s+=m}var b=(s/1048576).toFixed(2);var u=function(c){return parseInt(c)||0};function e(c){return YAHOO.util.Number.format((c/1048576),{thousandsSeparator:",",decimalPlaces:2})}var O="";var C=function(i,d,r){if(i.charAt(0)==="."){return}var af;if(d){af=(d.charAt(0)==="/")?d:CPANEL.security_token+"/frontend/x3/filemanager/index.html?dirselect=homedir&dir=/"+encodeURIComponent(d);af='<a href="'+af.html_encode()+'" target="_blank">'+i.html_encode()+"</a>"}var c=u((r/J)*100);if(c&&c<3){c=3}O+=YAHOO.lang.substitute(g,{url:af||i.html_encode(),width:c,usage:e(r)})};var g=document.getElementById("table-row-template").text.trim();var Q=u(p[0].quotalimit);var L=p[0].homedir.contents;var f=L.length;var j=u(p[0].mysql);var N=u(p[0].pgsql);var F=u(p[0].mailman);var a=u(p[0].quotaused);var M=u(p[0].quotalimit);var ad=u(p[0].homedir.contained_usage);var H=0;var T=0;var J=Math.max(j,N,F);for(var V=0;V<f;V++){var aa=u(L[V].contained_usage);if(L[V].name.charAt(0)==="."){T+=aa}else{H+=aa;if(aa>J){J=aa}}}var x=ad-H-T;if(x>J){J=x}if(T>J){J=T}C(LOCALE.not_in_subdir,null,x);C(LOCALE.hidden_subdirs,null,T);for(var V=0;V<f;V++){if(L[V].name.charAt(0)!=="."){C(L[V].name+"/",L[V].name,L[V].contained_usage)}}C("MySQL","/frontend/x3/sql/",j);if(has_postgres){C("PostgreSQL","/frontend/x3/psql/",N)}C(LOCALE.mailing_lists,null,F);var w=0;if(a){var w=a-u(p[0].homedir.user_contained_usage);if(w>0){C(LOCALE.other_usage,null,w)}if(M>0){if(a>=M){new CPANEL.widgets.Notice({content:LOCALE.over_quota,level:"error"})}else{if((a/M)>0.9){new CPANEL.widgets.Notice({content:LOCALE.warn_quota,level:"warn"})}}}}var t=ad+j+N+F+w;var ae=DOM.get("total_disk_usage_template").text.trim();ae=YAHOO.lang.substitute(ae,{mib:e(t)});O+=ae;if(Q>0){var X=DOM.get("quota_usage_template").text.trim();X=YAHOO.lang.substitute(X,{limit:e(M),used:e(a)});O+=X}document.getElementById("usage-table").innerHTML=O;var W=build_dom_rows(U.contents,"","name");var n=(U.contained_usage/1048576).toFixed(2);document.getElementById("table_container").innerHTML=TABLE_TEMPLATE;var K=document.createElement("div");var Z=YAHOO.lang.substitute(DIRS_TABLE_ROW_TEMPLATE,{dir_name:'<img class="home_dir" src="'+HOME_IMAGE_HTML+'" alt="home" />/',path:"/",path_uri:"/",expander_html:"",indentation_html:"",formatted_bytes:n,raw_bytes:U.contained_usage});K.innerHTML="<table>"+Z+"</table>";Utility_Fragment.appendChild(K.getElementsByTagName("tr")[0]);var v=document.getElementById("directory_rows_tbody");var z=W.length;for(var R=0;R<z;R++){Utility_Fragment.appendChild(W[R])}v.appendChild(Utility_Fragment);DOM.get("sort_div").style.display="";DOM.get("hidden_copy").style.display="";Rows_Data=U.contents}YAHOO.util.Event.onDOMReady(function(){TABLE_TEMPLATE=document.getElementById("dirs_table_template").text;cpanel_jsonapi2(du_callback,"DiskUsage","fetchdiskusagewithextras")});var Sort_By_Name=true;function flip_sort(b){if(b&&Sort_By_Name){return false}var a=b?"name":"!contained_usage";_sort_and_append_contents(Rows_Data,a,DOM.get("directory_rows_tbody"));Sort_By_Name=!Sort_By_Name}function _sort_and_append_contents(b,a,c){b.sort_by(a);for(var e=0;e<b.length;e++){var d=b[e];if(!("dom_object" in d)){continue}c.appendChild(d.dom_object);if(("contents" in d)&&(d.contents instanceof Array)){_sort_and_append_contents(d.contents,a,c)}}}function show_row(e,h){var j=e.getElementsByTagName("div");var g=j.length;var c=g+1;var b;if(h){b=function(){c--;if(c===0){h.call(this)}}}var a=e.style;for(var i=0;i<g;i++){j[i].style.display="none"}a.display="";for(var i=0;i<g;i++){CPANEL.animate.slide_down(j[i],b)}a.opacity=0;var f=new YAHOO.util.Anim(e,{opacity:{to:1}},0.2);if(h){f.onComplete.subscribe(b)}f.animate()}function hide_row(a,e){var b=a.getElementsByTagName("div");var c=b.length;var f=c+1;var i=function(){f--;if(f===0){a.style.display="none";if(e){e.call(this)}}};for(var h=0;h<c;h++){CPANEL.animate.slide_up(b[h],i)}var g=new YAHOO.util.Anim(a,{opacity:{to:0}},0.2);g.onComplete.subscribe(i);g.animate()}var toggle_children=function(f,h){if(f in Expanding){return}var e=document.getElementById(f+"-icon");var k=(f in Expanded_Rows);if(h===undefined){h=!k}else{if(h===k){return}}if(h){Expanded_Rows[f]=true}else{delete Expanded_Rows[f]}var c=Ancestry[f];Expanding[f]=true;DOM.removeClass(e,"expander");if(c){var l=c.length;var p=l;for(var j=0;j<l;j++){var n=c[j];var i=document.getElementById(n+"-row");if(h){e.src=MINUS_IMAGE;e.title=LANG.hide_children;show_row(i,function(){p--;if(p===0){delete Expanding[f];DOM.addClass(e,"expander")}})}else{hide_row(i,function(){p--;if(p===0){e.src=PLUS_IMAGE;e.title=LANG.see_children;delete Expanding[f];DOM.addClass(e,"expander")}});if((n in Ancestry)&&Ancestry[n].length>0){toggle_children(n,h)}}}}else{e.src=SPINNER_IMAGE;var m=function(v){var u=v[0].contents;var q=build_dom_rows(u,f,a,false);var s=q.length;var w=s;for(var t=0;t<s;t++){Utility_Fragment.appendChild(q[t])}g.insertBefore(Utility_Fragment,o);for(var t=0;t<s;t++){var d=q[t];show_row(d,function(){w--;if(w===0){e.src=MINUS_IMAGE;e.title=LANG.hide_children;DOM.addClass(e,"expander");delete Expanding[f]}})}Path_Data[f].contents=u};cpanel_jsonapi2(m,"DiskUsage","fetchdiskusage","path",f);var a=Sort_By_Name?"name":"!contained_usage";var b=document.getElementById(f+"-row");var g=b.parentNode;var o=b.nextSibling}};
<cpanel setvar="dprefix=../">
<cpanel Branding="include(stdheader.html)">

<!-- The Dir Box Below
        <cpanel setvar="autodirsonly=1">
        <cpanel setvar="autoinput=path">
        <cpanel setvar="autofunc=pathDirComplete">
-->
<script type="text/javascript">
    <cpanel relinclude="js/expander_optimized.js">

truncate_on=1;
truncate_wrap = 1;
truncate_tooltips = 0;
register_truncate_table('manage-ror');
var chpanel;

function nullop() {
    var hidepanel = function() {
        chpanel.hide();
    }
    setTimeout(hidepanel,5000);
}


function showchanged(bodytxt) {

    if (!chpanel) { 
        chpanel = new YAHOO.widget.Panel("chpanel",  
            { width:"350px", 
              fixedcenter:true, 
              close:true, 
              draggable:true, 
              zindex:4,
              modal:false,
              visible:false
            } 
        );
        chpanel.setHeader("<h4><cpanel langprint="RORChgComp"></h4>");
    }
    chpanel.setBody(bodytxt);
    chpanel.render();
    chpanel.show();
}

function change_production(appname,checkobj) {
    var newval = checkobj.checked ? 0 : 1;
    showchanged("<p>" + appname + " <cpanel langprint="RRProdMsg1"> " + (checkobj.checked ? '<cpanel langprint="RRProdMsg2">' : '<cpanel langprint="RRProdMsg3">') + " <cpanel langprint="RRProdMsg4"></p>");
    cpanel_jsonapi2(nullop,'RoR','changeapp','appname',appname,'env',newval);
};
function change_boot(appname,checkobj) {
    var newval = checkobj.checked ? 1 : 0;
    showchanged("<p>" + appname  + (checkobj.checked ? '<cpanel langprint="RRLoadMsg1">' : '<cpanel langprint="RRLoadMsg2"></p>'));
    cpanel_jsonapi2(nullop,'RoR','changeapp','appname',appname,'newloadonboot',newval);
};

function remove_object(thisobj) {
    var objEl = document.getElementById(thisobj);
    var objParent = objEl.parentNode;
    objParent.removeChild(objEl);
}

function setpath(inputobj) {
    var pathValue = document.getElementById('appname').value;
    pathValue = pathValue.replace(/\s/g,"");
    if (document.getElementById('path').value == '') {    
        document.getElementById('path').value = 'rails_apps/' + pathValue;
    }
}
function pathDirComplete(inputObj) {

}

function checkform () {
    var appname = document.addrorform.appname.value;
    if (appname == '') {
        alert("<cpanel langprint="RubyAppsWarnName">");
		document.addrorform.appname.select();
	    document.addrorform.appname.focus();
        return false;
    	}
	if (appname.length > 15) {
	    alert("<cpanel langprint="RubyAppsLengthError">")
	    document.addrorform.appname.select();
	    document.addrorform.appname.focus();
	    return false;
	    }
	var path = document.addrorform.path.value;
	if (path == '') {
        alert("<cpanel langprint="RubyAppsWarnPath">");
		document.addrorform.path.select();
	    document.addrorform.path.focus();
        return false;
    	}
    return true;
}

</script>
<style type="text/css">
<?cp Branding::spritelist(.spriteicon_img_mini {float:left;margin-right:5px;background: url\{leftparenthesis}"%"\{rightparenthesis};} %,@spriteurl,images::#icon-${img}_mini {background-position\{colon}0 -${cssposition}px;width\{colon}${width}px;height\{colon}${height}px; }:) imgtype=icon,subtype=img,method=scale_60percent,format=png,img=rails?>
</style>
<cpanel relinclude="expander/css_include.html">
<script type="text/javascript">
register_expander_container('manage-ror');
register_expander_obj('start-button');
register_expander_obj('stop-button');
</script>

<div class="body-content">
<div class="h1Title"><div class="spriteicon_img_mini" id="icon-rails_mini"></div><cpanel langprint="RubyAppsHead"></div>
<p class="description"><cpanel langprint="RubyAppsDesc"></p>

<h2><cpanel langprint="RubyAppsCreate"></h2>


<!-- <?cp RoR::needsimport(%,) ?> -->

<cpanelif $CPVAR{'ror_needsimport'}>
    <!-- <?cp RoR::importrails(%,) ?> -->
</cpanelif>

<form action="addror.html" method="post" onsubmit="return checkform();" name="addrorform">
	<div class="module">
		<p><label for="appname"><cpanel langprint="RubyAppsName"></label> <input type="text" id="appname" name="appname" maxlength="15" onchange="setpath(this);" /> <em><cpanel langprint="RORAppNameLimit"></em></p>
		<p><label for="loadonboot"><cpanel langprint="RubyAppsBoot"></label> <input type="checkbox" id="loadonboot" name="loadonboot" value="1" /></p>
		<p><label for="path"><cpanel langprint="RubyAppsAppPath"></label> <img src="../images/homeb.gif">/<cpanel relinclude="autodir/dirbox.html"></p>
		<p><label for="env"><cpanel Locale="maketext('Environment:')"></label> <select name="env"><option value="0"><cpanel Locale="maketext('production')"></option><option value="1"><cpanel Locale="maketext('development')"></option></select></p>
		<p><input type="submit" class="input-button" value="<cpanel langprint="WebDAVCreate">" /></p>
	</div>
</form>

<h2><cpanel langprint="RubyAppAvail"></h2>

<table class="sortable" id="manage-ror" border="0" cellspacing="0" cellpadding="0">
	<tr>
		<th><cpanel langprint="RubyAppsName"></th>
		<th><cpanel langprint="RubyAppsPath"></th>
		<th><cpanel langprint="RubyAppsServer"></th>
		<th><cpanel langprint="RubyAppsRunning"></th>
		<th><cpanel langprint="RubyAppsActions"></th>
		<th><cpanel langprint="RubyAppsBoot"></th>
		<th><cpanel Locale="maketext('Production')"></th>
		<th><cpanel langprint="RubyAppsDelete"></th>
	</tr>
	<?cp RoR::listapps(

    [tr]
		[td class="truncate"]%[/td]
		[td class="truncate"][img src="../images/homeb.gif" align=absmiddle]%[/td]
		[td class="truncate" align="center"][a href="http://$CPDATA{'DNS'}:%/" title="http://$CPDATA{'DNS'}:%/"]URL[/a][/td]
		[td align="center" class="app-status"]%[/td]
		[td width="100"][div class="expbox" onmouseover="runAnimOver[[this]];" id="start-button-%"][a class="start-button" href="startapp.html?appname=%"][img width=16 height=16 src="$BRANDINGIMG{'start32'}" border="0" /][br /]$LANG{'RubyAppsRun'}[/a][/div]
		[div class="expbox" onmouseover="runAnimOver[[this]];" id="stop-button-%"][a class="stop-button" href="stopapp.html?appname=%"][img width=16 height=16 src="$BRANDINGIMG{'stop32'}"  border="0" /][br /]$LANG{'RubyAppsStop'}[/a][/div][/td]
		[td align="center"][form action="changeboot.html"][input type="hidden" name="appname" value="%"][input value="1" onclick="change_boot[['%'\{comma}this]];" name="loadonboot" % type="checkbox" /][input id="submit_boot_%" type="submit" value="maketext('Change')" class="input-button"][/form][/td]
		[td align="center"][form action="changeproduction.html"][input type="hidden" name="appname" value="%"][input value="1" onclick="change_production[['%'\{comma}this]];" name="production" % type="checkbox" /][input id="submit_production_%" type="submit" value="maketext('Change')" class="input-button"][/form][/a][/td]
		[td align="center"][a href="deleteappconfirm.html?appname=%"][img border="0" src="../images/ror_icons/remove-delete.gif" alt="$LANG{'RubyAppsDelete'}" /][/a][/td]
	[/tr]
	[script]remove_object[['submit_production_%']];
remove_object[['submit_boot_%']];[/script]
	
		,name,path,port,port,running=1?running:not running,name,name,name,name,name,name,+loadonboot,name,name,name,+production,name,^name,name,name) || [tr][td colspan="6"]$LANG{'RubyAppsNone'}[/tr][/td] ?>
</table>
<div id="divgen_expand"></div>

<h2><cpanel langprint="RubyAppsRewrite"></h2>
<p class="description"><cpanel langprint="RubyAppsRewriteDesc"></p>

<h2><cpanel langprint="RORCreateRW"></h2>
<table class="sortable" border="0" cellspacing="0" cellpadding="0" width="700">
	<tr>
		<th align="center"><cpanel langprint="RubyAppsName"></th>
		<th><cpanel langprint="RORAct"></th>
	</tr>
<?cp RoR::listapps(
	[tr]
		[form action="createrewrite.html" method="get"]
		[td class="appname-cell"]%[/td]
		[td class="rewrite-cell" align="center"]
			[input type="hidden" name="appname" value="%" /]
			[input type="hidden" name="port" value="%" /]
			[input type="submit" class="input-button" value="$LANG{'RORCreatReBtn'}" /]
		[/td]
		[/form]
	[/tr]
,name,name,port)|| [tr][td colspan="2"]$LANG{'RubyAppsNone'}[/tr][/td] ?>
</table>

<h2><cpanel langprint="RORCurrRW"></h2>
<table class="sortable" id="manage-ror-rewrites" border="0" cellspacing="0" cellpadding="0" width="700">
	<tr>
		<th><cpanel langprint="RubyAppsName"></th>
		<th><cpanel langprint="RubyAppsRewriteURL"></th>
		<th colspan="2"><cpanel langprint="RubyAppsActions"></th>
	</tr>
	<?cp RoR::listrewrites(
		[tr]
			[form action="saverewrite.html" method="post"]
			[td]%[/td]
			[td]
				[input type="hidden" name="appname" maxlength="15" value="%" /]
				[input type="hidden" name="domain" value="%" /]
				[input type="hidden" name="port" value="%" /]
				[input type="hidden" name="oldurl" value="%" /]
				http://%/[input type="text" name="url" value="%" size="9" class="url-input" /] 
				[img src="../images/arrowto.gif" align="absmiddle" /] 
				http://$CPDATA{'DNS'}:%/
			[/td]
			[td class="nobrd-right"][input class="input-button" type="submit" value="$LANG{'RubyAppsSave'}" /][/td]
			[td][a class="create-button" href="deleterewriteconfirm.html?appname=%&rewritedomain=%&rewriteurl=%"]$LANG{'RubyAppsDelete'}[/a][/td]
			[/form]
		[/tr]
            ,appname,appname,domain,port,url,domain,url,port,appname,domain,url) || [tr][td colspan="3"]$LANG{'RubyAppsNoneRewrite'}[/tr][/td] ?>
</table>


<div class="return-link"><a href="../index.html">&larr; <cptext "Go Back"></a></div>
</div>
<!---LoadonBoot Alert Win Code--->
<div id="chpanel"></div>
<!---End Help Code--->
<cpanel Branding="include(stdfooter.html)">

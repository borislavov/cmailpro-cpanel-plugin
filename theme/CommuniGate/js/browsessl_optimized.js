function checkcrt(){var a=document.getElementById("sslcrt");if(a&&a.value){lookupinfo("crtdata")}}function sslInfoOk(e){var b=e.responseXML;var a=b.getElementsByTagName("sslinfo")[0];var f={};if(!a){alert("The server returned invalid xml data: "+e.responseText);if(typeof waitpanel!=="undefined"){waitpanel.hide()}return}f.key=a.getElementsByTagName("key")[0];f.cab=a.getElementsByTagName("cab")[0];f.crt=a.getElementsByTagName("crt")[0];f.domain=a.getElementsByTagName("domain")[0];f.ip=a.getElementsByTagName("ip")[0];f.user=a.getElementsByTagName("user")[0];for(var c in f){if(f[c]&&f[c].textContent){f[c]=f[c].textContent}else{if(f[c]&&f[c].firstChild){f[c]=f[c].firstChild.nodeValue}else{f[c]=""}}}for(var c in f){if(!f[c]||f[c]==""){continue}if(e.argument){if(e.argument=="crt"){if(c!="cab"&&c!=e.argument){continue}}else{if(c!=e.argument){continue}}}var d="ssl"+c;setoptvalue(d,f[c])}if(typeof waitpanel!=="undefined"){waitpanel.hide()}}function lookupinfo(b,c,f){var h={success:sslInfoOk,failure:searchFailed,argument:c};var d=CPANEL.security_token+"/xml-api/fetchsslinfo";var g;var e=getoptvalue("ssldomain");var a=getoptvalue("sslcrt");if(!f&&(!c||c=="")&&b=="domain"&&!a.match("Sorry")&&a!=""){return}if(b=="domain"&&e){g="domain="+encodeURIComponent(e)}else{if(a){g="crtdata="+encodeURIComponent(a)}else{return}}if((typeof waitpanel!=="undefined")&&self.show_loading){show_loading("SSL Installer","Fetching SSL Data")}YAHOO.util.Connect.asyncRequest("POST",d,h,g)}function setoptvalue(d,c){var b=document.getElementById(d);if(!b){return}if(b.options){for(var a=0;a<b.options.length;a++){if(b.options[a].value==c){b.selectedIndex=a;break}}}else{b.value=c}}function getoptvalue(b){var a=document.getElementById(b);if(!a){return}if(a.options){return a.options[a.selectedIndex].value}else{return a.value}}function handleCancel(){this.hide()}function handleSubmit(){var d=document.getElementById("crtlist");var e=d.options[d.selectedIndex].value;var b=0;var c;for(var a=0;a<document.forms.length;a++){if(document.forms[a].domain){c=document.forms[a];break}}if(!c){c=document.forms[a]}if(c.domain.value!=e){b=1}c.domain.value=e;lookupinfo("domain",0,b);this.hide()}var ssl_results_panel;function browsessl(a){var c={success:searchOk,failure:searchFailed};var b=(a?CPANEL.security_token+"/xml-api/listcrts":CPANEL.security_token+"/xml-api/listcrts?registered=1");YAHOO.util.Connect.asyncRequest("GET",b,c)}function searchFailed(){alert("Unable to get certificate list.")}function searchOk(f){var b=f.responseXML;var a=b.getElementsByTagName("crt");ssl_results_panel.show();var e=ssl_results_panel.body.getElementsByTagName("select")[0];for(var c=0;c<e.options.length;c++){e.options[c]=null}e.options.length=0;for(var c=0;c<a.length;c++){var d=a[c].getElementsByTagName("domain")[0].firstChild.nodeValue;e.options[c]=new Option(d,d)}}function init_panels(){if(!document.getElementById("sslbrowse")){return}ssl_results_panel=new YAHOO.widget.Dialog("ssl_results_panel",{width:"400px",fixedcenter:true,close:true,draggable:true,modal:true,buttons:[{text:"Use Cert",handler:handleSubmit,isDefault:true},{text:"Cancel",handler:handleCancel}],visible:false});ssl_results_panel.setHeader("SSL Certificate List");ssl_results_panel.setBody('<div style="height: 280px; overflow:auto;"><form><p>Only domains managed by cPanel listed here:</p><select style="width:390px;margin: 0 auto;" size="16" id="crtlist" name="crts"></select></form></div>');var a=document.getElementById("sdiv");if(!a){a=document.body}ssl_results_panel.render(a);ssl_results_panel.beforeHideEvent.subscribe(function(){var c=this.body.getElementsByTagName("select")[0];for(var b=0;b<c.length;b++){c.options[b]=null}},ssl_results_panel,true)}function checkentries(){var d=["domain","ip","user"];for(var b=0;b<d.length;b++){var a="ssl"+d[b];var c=document.getElementById(a);if(c){c.style.width=(c.parentNode.offsetWidth)-2+"px"}}}YAHOO.util.Event.addListener(window,"load",init_panels);YAHOO.util.Event.addListener(window,"load",checkcrt);YAHOO.util.Event.addListener(window,"load",checkentries);
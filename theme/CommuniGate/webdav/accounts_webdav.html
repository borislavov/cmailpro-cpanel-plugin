<cpanel setvar="dprefix=../">
<cpanel Branding="include(stdheader.html)">
	
<style type="text/css">
<?cp Branding::spritelist(.spriteicon_img_mini {float:left;margin-right:5px;background: url\{leftparenthesis}"%"\{rightparenthesis};} %,@spriteurl,images::#icon-${img}_mini {background-position\{colon}0 -${cssposition}px;width\{colon}${width}px;height\{colon}${height}px; }:) imgtype=icon,subtype=img,method=scale_60percent,format=png,img=webdav ?>
</style>	
	
<script type="text/javascript">
//<![CDATA[
truncate_on = 1;

var REQUIRED_PASSWORD_STRENGTH = parseInt('<?cp PasswdStrength::get_required_strength(%,strength) app=webdisk ?>') || 0;

var user_validator = new CPANEL.validate.validator("<cpanel Locale="maketext('Webdav Login')">");
var dir_validator = new CPANEL.validate.validator("<cpanel Locale="maketext('Directory')">");

var update_directory = function() {
    if (checkuser() == true) {
		YAHOO.util.Dom.get("homedir").value = "public_html/" + YAHOO.util.Dom.get("user").value;
		dir_validator.verify();
	}
};

// note: should probably move this function into the CJT validator library
var checkuser = function() {
    var user = YAHOO.util.Dom.get("user").value;
    if (user == '') {
        return false;
    }
    if (user.length > 25) {
        return false;
    }
    var pattern = /^[a-z0-9_-]+$/i;
    if (user.match(pattern) == null) {
        return false;
    }
    return true;
};

var init_page = function() {
	user_validator.add("user", checkuser, "<cpanel langprint="webdav_login_main">");
	user_validator.add("user", "alphanumeric_bookends", "<cpanel langprint="webdav_alphanumeric_bookends">");
	user_validator.attach();
	
	dir_validator.add("homedir", "dir_path", "<cpanel langprint="validation_directory_paths">");
	dir_validator.attach();
	
	var password_validators = CPANEL.password.setup("password", "password2", "password_strength", REQUIRED_PASSWORD_STRENGTH, "create_strong_password", "why_strong_passwords_link", "why_strong_passwords_text");
	
	password_validators.push(user_validator, dir_validator);
	CPANEL.validate.attach_to_form("submit", password_validators);
	
	YAHOO.util.Event.on("user", "change", update_directory);
	
	YAHOO.util.Dom.get("user").focus();
};
YAHOO.util.Event.onDOMReady(init_page);
//]]>
</script>

<div class="body-content">
	
<div class="h1Title"><div class="spriteicon_img_mini" id="icon-webdav_mini"></div><cpanel langprint="MENUWebDAVAccounts"></div>

<p class="description"><cpanel langprint="WebDAVDescription"></p>

<cpanel setvar="vidtut_name=webdisk">
<cpanel setvar="vidtut_header=MENUWebDisk">
<cpanel setvar="vidtut_description=VidWebDiskDesc">
<cpanel setvar="vidtut_video_name=webdisk_lo">
<cpanel setvar="vidtut_width=450">
<cpanel setvar="vidtut_height=353">
<cpanel include="../video_tutorial_include.html">

<p><cpanel langprint="WebDAVDisks"> <cpanel langprint="subDesc5"> <cpanel print="$homedir">.</p>

<h2><cpanel langprint="WebDAVAddAccount"></h2>
<?cp StatsBar::stat( [p class="caution"]$LANG{'statsattention'}&nbsp;%&nbsp;$LANG{'statsoutof'}&nbsp;%$LANG{'available'}&nbsp;$LANG{'MENUWebDAVAccounts'}[/p],count,max) display=webdavaccounts,warnings=1,warninglevel=80,infinitylang=true ?>

<div class="highlight">
<form method="post" action="doaddwebdav.html" name="mainform" id="mainform">	
	<table>
		<tr>
			<td align="right"><cpanel langprint="WebDAVLogin"></td>
			<td><input name="user" type="text" size="25" id="user" style="width: 150px" /></td>
			<td>@
				<!-- <?cp Email::listmaildomains(,) ?> -->
				<cpanelif $CPVAR{'maildomainscount'}==1>
					<?cp Email::listmaildomains(% [input type="hidden" name="domain" value="%" /],domain,domain) ?>
				</cpanelif>
				<cpanelif $CPVAR{'maildomainscount'}=gt=1>
					<select name="domain">
					<?cp Email::listmaildomains([option value="%"]%[/option],domain,domain) ?>
					</select>
				</cpanelif>
			</td>
			<td><div id="user_error"></div></td>
		</tr>
		<tr>
			<td align="right" style="width: 120px"><cpanel langprint="EANewpass"></td>
			<td><input type="password" name="password" id="password" style="width: 150px" /></td>
			<td><div id="password_error"></div></td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td align="right"><cpanel langprint="ASIReadOtherPasswordAgain"></td>
			<td><input type="password" name="password2" id="password2" style="width: 150px" /></td>
			<td><div id="password2_error"></div></td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td align="right">
				<cpanel langprint="email_strength"> (<div style="display: inline" id="why_strong_passwords_link" class="action_link"><cpanel langprint="email_why"></div>):
				<div id="why_strong_passwords_text" style="display: none"><cpanel langprint="email_password_why"><br /><br /><cpanel langprint="email_password_tip"></div>
			</td>
			<td><div id="password_strength" style="width: 150px; height: 20px; border: 1px solid black; margin: 5px 0px 3px 0px"></div></td>
			<td colspan="2"><input type="button" id="create_strong_password" class="input-button" value="<cpanel langprint="cjt_password_generator">" tabindex="-1" /></td>
		</tr>
		<tr>
			<td align="right"><cpanel langprint="WebDAVDirectory"> <img src="../images/homeb.gif" alt="<cpanel Locale="maketext('home')">" align="middle" />/</td>
			<td colspan="3">
				<cpanel setvar="autoinput=homedir">
				<cpanel setvar="autodirsonly=1">
				<cpanel setvar="autofunc=dirComplete">
				<script type="text/javascript">
				function dirComplete(inputObj) {}
				</script>
				<cpanel relinclude="autodir/dirbox.html">
			</td>
		</tr>
		<tr><td colspan="4"><br /></td></tr>
		<tr>
			<td>&nbsp;</td>
			<td colspan="3"><input type="submit" id="submit" class="input-button" value="<cpanel langprint="WebDAVCreate">" /></td>
		</tr>
	</table>
</form>
</div><!-- end highlight -->

<br /><br />

<h2><cpanel langprint="WebDAVAcctManagement"></h2>

<table width="690"  border="0" cellpadding="2" cellspacing="0" id="webdavtbl" fixedtruncate="1" class="truncate-table sortable">
	<tr>
		<th class="cell" scope="col"><cpanel langprint="WebDAVthLogin"></th>
		<th class="cell" scope="col"><cpanel langprint="WebDAVthDirectory"></th>
		<th class="cell sorttable_nosort" scope="col"><cpanel langprint="WebDAVthAccess"></th>
		<th class="cell sorttable_nosort" scope="col" colspan="3"><cpanel langprint="WebDAVActions"></th>
	</tr>
	<tr class="row-even">
		<td class="cell truncate" truncate="25" align="center"><cpanel print="$user"></td>
		<td align="left" class="cell"><img align="middle" src="../images/homeb.gif" alt="<cpanel Locale="maketext('home')">" />/</td>
		<cpanelif $ENV{'HTTP_PROXIED'}>
			<cpanel ProxyUtils="proxyaddress('webdisk')">
			<td class="cell" align="center"><a href="webdavaccessdownload.html?domain=<cpanel print="$CPVAR{'new_proxy_domain'}">&amp;sslport=<cpanel print="$sslhttpdport">&amp;mainport=<cpanel print="$mainhttpdport">" class="create-button"><cpanel langprint="WebDAVthAccess"></a></td>
		</cpanelif>
		<cpanelif !$ENV{'HTTP_PROXIED'}>
			<td class="cell" align="center"><a href="webdavaccessdownload.html?domain=<cpanel print="$CPDATA{'DNS'}">&amp;sslport=2078&amp;mainport=2077" class="create-button"><cpanel langprint="WebDAVthAccess"></a></td>
		</cpanelif>
		<td class="nobrd" align="center" colspan="3"><cpanel langprint="WebDAVNA"></td>
	</tr>

	<?cp WebDisk::listwebdisks(
	[tr class="row-%"]
		[td class="cell truncate" align="center" truncate="15"]%[/td]
		[td align="left" class="cell truncate" truncate="35"][img align="middle" src="../images/homeb.gif" alt="" /]/%[/td]
		[td class="cell" align="center"][a href="webdavaccessdownload.html?domain=%&amp;sslport=%&amp;mainport=%" class="create-button"]$LANG{'WebDAVthAccess'}[/a][/td]
		[td width="20px" class="nobrd" align="center"][a href="passwd.html?login=%"]$LANG{'TChangePass'}[/a][/td]
		[td width="20px" class="nobrd" align="center"][a href="del_confirm.html?login=%"]$LANG{'Delete'}[/a][/td]
		[td width="20px" align="center"][a href="../htaccess/dohtaccess.html?dir=$homedir/%"]$LANG{'WebDiskPassProtect'}[/a][/td]
	[/tr]
	,*num,login,reldir,domain,sslport,mainport,login,login,reldir)?>

</table>

</div><!-- end body-content -->
<cpanel Branding="include(stdfooter.html)">
